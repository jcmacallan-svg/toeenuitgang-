/* v7.4.12 patch v5
   Fixes:
   - Student bubbles always BLUE (even when student speaks twice)
   - Visitor bubbles always LIGHT GREY
   - Student stays RIGHT-aligned, Visitor stays LEFT-aligned
   - ID card: remove full-width white backdrop; make card fully white, larger, with dark text

   Load this AFTER styles.css and any earlier patch CSS.
*/

/* =========================
   CHAT (alignment + colors)
   ========================= */

/* Prefer the dynamic classes set by JS. Fall back to the static ones if needed. */
.msgRow.isVisitor,
.msgRow.visitor { 
  justify-content: flex-start !important;
}

.msgRow.isStudent,
.msgRow.student {
  justify-content: flex-end !important;
}

/* Bubble container should follow row alignment */
.msgRow.isVisitor .bubbleWrap,
.msgRow.visitor .bubbleWrap {
  align-items: flex-start !important;
}

.msgRow.isStudent .bubbleWrap,
.msgRow.student .bubbleWrap {
  align-items: flex-end !important;
}

/* Ensure bubbles don't stretch and sit on the correct side */
.msgRow .bubbleWrap {
  display: flex;
  flex-direction: column;
  max-width: min(620px, 70vw);
}

.msgRow.isStudent .bubbleWrap,
.msgRow.student .bubbleWrap {
  text-align: right;
}

.msgRow.isVisitor .bubbleWrap,
.msgRow.visitor .bubbleWrap {
  text-align: left;
}

/* --- Colors: key point is to style by SIDE, not by slot index --- */
:root{
  /* tweak if you want it darker/lighter later */
  --studentBubble: #2f79c6; /* slightly darker blue */
  --studentText:   #ffffff;
  --visitorBubble: #dfe5ee; /* light grey */
  --visitorText:   #0b1220;
}

.msgRow.isStudent .bubble,
.msgRow.student .bubble {
  background: var(--studentBubble) !important;
  color: var(--studentText) !important;
}

.msgRow.isVisitor .bubble,
.msgRow.visitor .bubble {
  background: var(--visitorBubble) !important;
  color: var(--visitorText) !important;
}

/* If there is any alternating styling via nth-child in the base CSS, kill it */
.msgRow:nth-child(odd) .bubble,
.msgRow:nth-child(even) .bubble {
  background: unset;
}

/* Keep typing dots readable on both colors */
.msgRow.isStudent .bubble.typing,
.msgRow.student .bubble.typing {
  background: var(--studentBubble) !important;
}

.msgRow.isVisitor .bubble.typing,
.msgRow.visitor .bubble.typing {
  background: var(--visitorBubble) !important;
}

/* Avatar sizing: make the avatar match the bubble height better */
.msgRow .avatar{
  width: 48px !important;
  height: 48px !important;
}

/* =========================
   ID CARD (size + background)
   ========================= */

/* Do NOT paint a giant white slab behind the ID */
#idSlot,
.idSlot,
.portraitAndId{
  background: transparent !important;
}

/* Center the card without stretching the container */
#idCardWrap,
.idCardWrap{
  background: transparent !important;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Make the ID card bigger and fully white */
.idCard,
.idCard.passport{
  background: #ffffff !important;
  color: #0b1220 !important;
  width: min(560px, 92%) !important;
  border-radius: 14px !important;
  box-shadow: 0 10px 24px rgba(0,0,0,0.28) !important;
}

/* Remove inner grey panels if they exist */
.idCard *{
  background-color: transparent;
}

/* Keep the actual outer card white */
.idCard{ background-color: #ffffff !important; }

/* Readability */
.idCard .idFields,
.idCard .idRow{
  color: #0b1220 !important;
}

.idCard .idRow .k{
  color: rgba(11,18,32,0.65) !important;
  font-weight: 700 !important;
}

/* Improve ID photo sizing */
.idCard .idPhoto{
  width: 112px !important;
  height: 112px !important;
  object-fit: cover;
  border-radius: 10px !important;
  border: 2px solid rgba(11,18,32,0.12) !important;
}

/* Stamps: keep them visible on white */
.idCard .stamp{
  background: rgba(47,121,198,0.12) !important;
  color: #1c4f86 !important;
  border: 1px solid rgba(47,121,198,0.35) !important;
}
/* =========================
   VEVA miniPatch v6
   - Max 4 bubbles visible
   - Layout 50/50 chat vs ID area
   ========================= */

/* 1) Max 4 bubbles: hide slot4/slot5 ALWAYS */
#slot4, #slot5 {
  display: none !important;
}

/* 2) 50/50 layout: chat left, portrait/ID right, input spans full width */
.content {
  display: grid !important;
  grid-template-columns: 1fr 1fr !important;  /* 50/50 */
  grid-template-rows: 1fr auto !important;
  gap: 16px !important;
  align-items: start !important;
}

/* Keep chat and ID area in their columns */
#chatArea {
  grid-column: 1 !important;
  grid-row: 1 !important;
  min-width: 0 !important;
}

#idSlot {
  grid-column: 2 !important;
  grid-row: 1 !important;
  min-width: 0 !important;
}

/* Input bar across BOTH columns */
.inputBar {
  grid-column: 1 / -1 !important;
  grid-row: 2 !important;
}

/* (optioneel) iets meer “presence” voor het rechter paneel */
#idSlot {
  padding-left: 10px !important;
}

/* 3) Kleur-garantie: soldier altijd blauw, visitor altijd lichtgrijs */
.msgRow.student .bubble {
  background: #2f6fec !important; /* iets donkerder blauw */
  color: #ffffff !important;
}
.msgRow.visitor .bubble {
  background: #e6e9ef !important; /* lichtgrijs */
  color: #0b1220 !important;
}
/* v7.4.12 patch v4
   Goal: do NOT show empty chat slots at start.
   Root cause: earlier patch CSS forced msg rows to display even when the DOM sets [hidden].
   Fix: ensure the HTML hidden attribute always wins.
*/

/* Always honor the hidden attribute */
.msgRow[hidden],
.msgRow.hidden,
[hidden] { display: none !important; }

/* Safety: if a bubble is truly empty, hide the whole row (best-effort). */
.msgRow .bubble:empty { display:none !important; }

/* v7.4.12 PATCH v3
   Fixes student/right alignment bug introduced by row-reverse + flex-end.
   Also flips visual flow so NEWEST (slot0) appears at the BOTTOM (chat flows top→bottom).

   What this assumes:
   - app.js toggles .isVisitor / .isStudent on each .msgRow (it does in your code)
   - your rows have the structure: .msgRow > img.avatar + .bubbleWrap
*/

/* ===== 0) Flow direction: newest at bottom ===== */
/* app.js currently renders newest into #slot0. By reversing the visual order of children,
   #slot0 will be displayed at the bottom, so the conversation grows downward. */
#chatArea.chatArea{
  display:flex;
  flex-direction:column-reverse;
}

/* ===== 1) Base row layout ===== */
.chatArea .msgRow{
  display:flex;
  align-items:flex-start;
  gap:14px;
  margin:18px 0;
  width:100%;
}

/* ===== 2) Visitor ALWAYS left (avatar outside/left) ===== */
.chatArea .msgRow.isVisitor,
.chatArea .msgRow.visitor:not(.isVisitor):not(.isStudent){
  justify-content:flex-start !important;
  flex-direction:row !important;
  text-align:left;
}

/* ===== 3) Student/Soldier ALWAYS right (avatar outside/right) ===== */
/* IMPORTANT: do NOT use row-reverse here, because justify-content:flex-end would then
   push content visually to the left. Instead we keep row, and reorder the avatar. */
.chatArea .msgRow.isStudent,
.chatArea .msgRow.student:not(.isVisitor):not(.isStudent){
  justify-content:flex-end !important;
  flex-direction:row !important;
  text-align:left; /* keep bubble text readable */
}

/* Put avatar on the outside (right edge) for student rows */
.chatArea .msgRow.isStudent .avatar,
.chatArea .msgRow.student:not(.isVisitor):not(.isStudent) .avatar{
  order:2;
}
.chatArea .msgRow.isStudent .bubbleWrap,
.chatArea .msgRow.student:not(.isVisitor):not(.isStudent) .bubbleWrap{
  order:1;
}

/* ===== 4) Avatar sizing (match bubble height better) ===== */
.chatArea .msgRow .avatar{
  width:56px;
  height:56px;
  border-radius:999px;
  object-fit:cover;
  flex:0 0 56px;
}

/* ===== 5) Bubble sizing ===== */
.chatArea .msgRow .bubbleWrap{
  max-width:min(720px, 70%);
}

.chatArea .msgRow .bubble{
  word-wrap:break-word;
  overflow-wrap:anywhere;
}

/* ===== 6) ID card: full white interior + dark text ===== */
#idCardWrap .idCard,
#idCardWrap .idCard.passport{
  background:#ffffff !important;
  color:#0b1220 !important;
  border:1px solid rgba(0,0,0,0.14) !important;
  box-shadow:0 12px 30px rgba(0,0,0,0.22) !important;
}

#idCardWrap .idPhotoWrap{
  background:#ffffff !important;
}

#idCardWrap .idFields{
  background:transparent !important;
}

#idCardWrap .idRow .k{
  color:rgba(11,18,32,0.65) !important;
}

#idCardWrap .idRow span:not(.k){
  color:#0b1220 !important;
  font-weight:700;
}

#idCardWrap .idStamps .stamp{
  background:rgba(11,18,32,0.06) !important;
  border:1px solid rgba(11,18,32,0.25) !important;
  color:#0b1220 !important;
}
